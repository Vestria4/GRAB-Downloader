<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Processing</title>
    <script>
        function processURL() {
            var inputURL = document.getElementById("inputURL").value;
            var levelId = inputURL.match(/level=([^&]+)/)[1];
            var userId = levelId.split(":")[0];

            var apiUrl = `https://api.slin.dev/grab/v1/list?max_format_version=7&user_id=${userId}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    var levelDataKey = data.levels[levelId].data_key;
                    var processedKey = levelDataKey.replace(/:/g, '/');
                    var downloadUrl = `https://api.slin.dev/grab/v1/download/${userId}/${levelId.split(":")[1]}/${processedKey}`;

                    // Redirect the user to the constructed download URL
                    window.location.href = downloadUrl;
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    alert("Error processing the URL. Please try again.");
                });
        }
    </script>
</head>

<body>
    <h1>URL Processing</h1>
    <label for="inputURL">Enter the URL:</label>
    <input type="text" id="inputURL" placeholder="https://grabvr.quest/levels/viewer/?level=2axkwzh6f43g1regf401p:1688176571">
    <button onclick="processURL()">Process</button>
</body>

</html>
